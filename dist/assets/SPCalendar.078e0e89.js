import{u as O,r as M,m,c as S,w as $,o as F,a as _,b as x,d as o,e as N,t as b,f as B,F as C,g as I,n as j,h as E,i as V,j as p,k as K,_ as z,l as A}from"./index.c430725a.js";const L={class:"p-5"},T={class:"font-nokora w-full bg-white border mx-auto p-2 rounded-xl"},W={class:"items-center justify-between flex mb-4"},X=["onClick"],q={class:"text-center"},G={class:"text-lg md:text-xl lg:text-2xl font-bold"},J={class:"text-lg md:text-xl text-gray-600 font-bold"},Q=["onClick"],R={class:"flex gap-2 justify-between text-center items-center mb-2 bg-white rounded-md border overflow-hidden font-bold text-lg"},Z={class:"grid gap-2 grid-cols-7"},tt={class:"flex lg:gap-1 flex-col items-center md:flex-row md:items-start"},et={class:"text-lg md:text-3xl font-bold shrink-0"},at={class:"w-full flex justify-center flex-col md:justify-start items-center md:items-end font-nokora text-sm md:text-base text-center"},st={key:0,class:"text-blue-600 hidden md:block"},nt={__name:"TheCalendar",props:{attributes:Object,currentKhmerMonths:String},emits:["onPrev","onNext","onUpdatePage"],setup(D,{emit:v}){const k=D,{khmerDate:y}=O(),d=M([]),r=M([]),a=M(m().month()+1),u=M(m().year()),g=S(()=>m(u.value+"-"+a.value+"-1","YYYY-M-D")),l=()=>{a.value--,a.value===0&&(a.value=12,u.value--),v("onPrev",{month:a.value,year:u.value}),v("onUpdatePage",{month:a.value,year:u.value})},Y=()=>{a.value++,a.value===13&&(a.value=1,u.value++),v("onNext",{month:a.value,year:u.value}),v("onUpdatePage",{month:a.value,year:u.value})};$(g,()=>{r.value.length=0,e()}),F(()=>{v("onPrev",{month:a.value,year:u.value}),v("onNext",{month:a.value,year:u.value}),v("onUpdatePage",{month:a.value,year:u.value}),r.value.length=0,e()});const e=()=>{d.value.length=0;for(let n=0;n<7;n++)d.value.push(m().locale("km").day(n).format("dddd"));let t=g.value,c=t.clone().daysInMonth(),s=t.day(),U=7-m(t.format("YYYY-MM-"+c)).day()-1,H=t.clone().subtract(1,"months").daysInMonth();for(let n=s;n>0;n--){let i=H-n+1,w=m(t.clone().subtract(1,"months").format("YYYY-MM-"+i),"YYYY-MM-D");r.value.push({prevMonth:!0,day:i,date:w,khDate:y.value(w),nextMonth:!1,attributes:h(w)})}for(let n=1;n<=c;n++){let i=m(t.format("YYYY-MM-"+n),"YYYY-MM-D");r.value.push({prevMonth:!1,day:n,date:i,khDate:y.value(i),nextMonth:!1,attributes:h(i)})}for(let n=1;n<=U;n++){let i=m(t.clone().add(1,"months").format("YYYY-MM-"+n),"YYYY-MM-D");r.value.push({prevMonth:!1,day:n,date:i,khDate:y.value(i),nextMonth:!0,attributes:h(i)})}},h=t=>k.attributes.filter(c=>t.isSame(c.dates)),f=t=>{let c=Object.assign([],t);return c.length?c.filter(s=>s.customData.description==="Holiday in Cambodia").length?"text-red-600 bg-red-100":"text-blue-600 bg-blue-100":"bg-white"};return(t,c)=>(_(),x("div",L,[o("div",T,[o("div",W,[o("div",null,[o("button",{type:"button",onClick:N(l,["prevent"])},"Prev.",8,X)]),o("div",q,[o("h2",G,b(D.currentKhmerMonths),1),o("h2",J,b(B(g).format("MMMM, YYYY")),1)]),o("div",null,[o("button",{type:"button",onClick:N(Y,["prevent"])},"Next",8,Q)])]),o("div",R,[(_(!0),x(C,null,I(d.value,(s,P)=>(_(),x("div",{key:s,class:j([P===0?"bg-red-600 text-white":"","w-full py-3"])},b(s),3))),128))]),o("div",Z,[(_(!0),x(C,null,I(r.value,s=>(_(),x("div",{key:s,class:j(["w-full aspect-[10/8] shadow rounded-md border md:p-2",[s.prevMonth||s.nextMonth?"opacity-20 bg-gray-100":"bg-white",f(s.attributes),s.date.weekday()===0?"text-red-600":""]])},[o("div",tt,[o("div",et,b(s.day),1),o("div",at,[o("div",null,b(s.khDate.toKhDate("d N")),1)])]),(s.khDate.khDay()===0||s.day===1)&&s.nextMonth===!1?(_(),x("div",st,b(s.khDate.toKhDate("m")),1)):E("",!0)],2))),128))])])]))}},ot={class:"flex-col-reverse lg:flex flex-col lg:flex-row gap-4 mx-auto"},lt={class:"w-full lg:w-2/3 shrink-0"},rt={class:"w-full"},dt={__name:"SPCalendar",setup(D){const{khmerDate:v}=O(),{events:k,traditional_events:y}=V(),d=M([{key:1,customData:{title:{kh:"\u1790\u17D2\u1784\u17C3",en:"today"},class:"bg-blue-600 text-white"},dates:p().format()}]),r=M([]),a=M([1,2]),u=l=>{r.value.length=0,d.value.length=0,g(l),d.value.sort(function(Y,e){return new Date(Y.dates)-new Date(e.dates)})},g=l=>{if(l.month===4){const{khmerNewYearAttrs:e}=A(l);d.value.push(...e.value)}k.value.filter(e=>e.start_date.month===l.month).forEach(e=>{d.value.push({key:"events"+p({y:l.year,M:l.month-1,D:e.start_date.day}).format("YYYY-MM-DD"),customData:{title:e.summary,description:e.description,class:"bg-red-600 text-white"},dates:p({y:l.year,M:l.month-1,D:e.start_date.day}).format("YYYY-MM-DD")})});let Y=p({y:l.year,M:l.month-1}).daysInMonth();for(let e=1;e<=Y;e++){let h=p({y:l.year,M:l.month-1,D:e}).format("YYYY-MM-DD"),f=v.value(h);r.value.push({khmer_month:f.toKhDate("m"),khmer_day:f.toKhDate("dN"),date:h}),y.value.filter(t=>r.value.filter(c=>c.khmer_month===t.start_date.month&&c.khmer_day===t.start_date.day).includes(t))}r.value.reduce(function(e,h){let f=y.value.filter(t=>t.start_date.month===h.khmer_month&&t.start_date.day===h.khmer_day);f.length&&f.forEach(t=>{d.value.push({key:"traditional_events"+h.date,customData:{title:t.summary,description:t.description,class:"bg-red-600 text-white"},dates:h.date})})}),a.value=[...new Set(r.value.map(e=>e.khmer_month))]};return(l,Y)=>(_(),x("div",ot,[o("div",lt,[K(nt,{attributes:d.value,onOnUpdatePage:u,"current-khmer-months":a.value[0]+" ~ "+a.value[1]},null,8,["attributes","current-khmer-months"])]),o("div",rt,[K(z,{events:d.value},null,8,["events"])])]))}};export{dt as default};
